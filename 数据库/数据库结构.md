01 SQL语句的执行

  MySQL基本架构

Server层
连接器
 作用：管理连接，权限验证
 
 - 连接命令：不要把密码直接写入命令行中
 - 密码认证通过后，查询权限列表中拥有的权限，之后将依赖于此时的权限。（修改权限仅仅影响新建立的链接
 - show processlist：查询已有连接命令
 - 连接
    - 短连接：执行少数查询就断开的连接。
    - 长连接：链接成功后，客户端使用同一个链接。因为MySQL执行过程中临时使用的内存管理在链接对象中，会导致内存占用过大。但是建立链接的开销较小。
-  解决
    - 1. 定时断开长连接
    - 2. 执行mysql_reset_connection初始化连接资源
         
    
查询缓存
作用：命中则直接返回结构
- 以key-value形式存在内存中
- 不建议使用查询缓存
    - 缓存失效频繁，一个表有更新，缓存被清空
    - 缓存命中率非常低
- 可以将query_cache_type设置为DEMAND，只有显示声明（SQL_CACHE）使用查询缓存才会使用。 

- 该功能8.0被删掉

分析器
作用：词法分析，语法分析

- 先做词法分析，识别关键字符串，表名，列名
- 语法分析，判断SQL是否满足MySQL语法

优化器
执行计划生成，索引选择

- 表里有多个索引的时候决定使用哪个索引
- 语句有多表关联的时候决定连接顺序

执行器
作用：操作引擎，返回结构

- 判定对于表是否有操作权限（实际工程，是否有权限有前置判定）
- 若有权限则打开表继续执行，若无则返回没有权限的错误
- 之后根据存储引擎的结构调用接口
- 调用 InnoDB 引擎接口取这个表的第一行，判断Where条件是否相等，不是则跳过，是则存在结果集中
- 调用引擎接口取下一行，判断，直到最后一行
- 将所有满足条件的行返回客户端

存储引擎层

  存储引擎
    存储数据，提供接口
  插件式架构
    InnoDB
    MyISAM
    Memory

